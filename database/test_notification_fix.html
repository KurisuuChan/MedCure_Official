<!DOCTYPE html>
<html>
<head>
    <title>Notification System Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 10px 0; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .info { background: #e9ecef; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Notification System Database Clear Test</h1>
    
    <div class="info">
        <strong>Test Procedure:</strong>
        <ol>
            <li>Open your main application in another tab</li>
            <li>Add some test notifications</li>
            <li>Use "Clear All" in the notification dropdown</li>
            <li>Come back here and click "Check Storage" to verify they're cleared</li>
            <li>Go back to the app and try adding new notifications</li>
            <li>Verify old notifications don't reappear</li>
        </ol>
    </div>

    <button onclick="checkLocalStorage()">Check Storage</button>
    <button onclick="clearStorageManually()">Manual Clear Storage</button>
    <button onclick="simulateNotificationAdd()">Simulate Notification Add</button>
    
    <div id="results"></div>

    <script>
        function checkLocalStorage() {
            const results = document.getElementById('results');
            const localStorage_data = localStorage.getItem('notifications');
            const sessionStorage_data = sessionStorage.getItem('notifications');
            
            results.innerHTML = `
                <div class="info">
                    <strong>Storage Check Results:</strong><br>
                    LocalStorage notifications: ${localStorage_data ? 'EXISTS (' + JSON.parse(localStorage_data).length + ' items)' : 'EMPTY'}<br>
                    SessionStorage notifications: ${sessionStorage_data ? 'EXISTS (' + JSON.parse(sessionStorage_data).length + ' items)' : 'EMPTY'}
                </div>
            `;
            
            if (!localStorage_data && !sessionStorage_data) {
                results.innerHTML += '<div class="success">✅ Storage properly cleared! The fix is working.</div>';
            } else {
                results.innerHTML += '<div class="error">❌ Storage still contains data. Clear All may not be working properly.</div>';
            }
        }

        function clearStorageManually() {
            localStorage.removeItem('notifications');
            sessionStorage.removeItem('notifications');
            document.getElementById('results').innerHTML = '<div class="success">✅ Storage manually cleared</div>';
        }

        function simulateNotificationAdd() {
            // This simulates what happens when new notifications are added
            const testNotification = {
                id: 'test_' + Date.now(),
                type: 'SYSTEM_INFO',
                title: 'Test Notification',
                message: 'This is a test notification',
                timestamp: Date.now(),
                isRead: false,
                isDismissed: false
            };
            
            const existing = JSON.parse(localStorage.getItem('notifications') || '[]');
            existing.push(testNotification);
            localStorage.setItem('notifications', JSON.stringify(existing));
            
            document.getElementById('results').innerHTML = '<div class="info">Added test notification to storage. Check your app to see if old notifications reappear.</div>';
        }
    </script>
</body>
</html>